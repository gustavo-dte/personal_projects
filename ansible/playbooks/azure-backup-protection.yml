---
# Playbook to enable Azure Backup protection for VMs using the azure_backup role
# This playbook loads VMs from the manifest, checks Azure Migrate replication status,
# and enables Azure Backup protection only for VMs that meet the replication threshold

- name: Enable Azure Backup Protection for VMs
  hosts: localhost
  connection: local
  gather_facts: no
  vars:
    verify_azure_account: true
  roles:
    - role: common
    - role: azure_backup
      vars:
        backup_action: enable_backup_protection
        manifest: "{{ manifest }}"
        dry_run: "{{ dry_run }}"
