---
# Playbook to start Azure Migrate replication for VMs using the azure_migrate role
# This playbook loads VMs from the manifest and starts replication for each VM,
# with idempotent handling to skip VMs that already have replication enabled

- name: Start migration replication
  hosts: localhost
  connection: local
  gather_facts: no
  vars:
    verify_azure_account: true
    all_replication_outputs: []
  roles:
    - role: common
    - role: azure_migrate
      vars:
        migration_action: start_replication
        dry_run: "{{ dry_run }}"
  post_tasks:
    - name: Replication request output
      ansible.builtin.debug:
        var: all_replication_outputs
