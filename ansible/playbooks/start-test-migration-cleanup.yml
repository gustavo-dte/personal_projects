---
# Playbook to start Azure Migrate test migration cleanup for VMs using the azure_migrate role
# This playbook loads VMs from the manifest and starts test migration cleanup for each VM,
# with prerequisite checking to ensure VMs have active replication

- name: Start test migration cleanup
  hosts: localhost
  connection: local
  gather_facts: no
  vars:
    verify_azure_account: true
    all_test_migration_cleanup_outputs: []
  roles:
    - role: common
    - role: azure_migrate
      vars:
        migration_action: test_migration_cleanup
  post_tasks:
    - name: Test migration cleanup request output
      ansible.builtin.debug:
        var: all_test_migration_cleanup_outputs
