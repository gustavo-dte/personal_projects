# Secret Detection Fix - README

## Issue
The pre-commit hook `detect-secrets` flagged two false positives:

1. `terraform\azure_sql\terraform-docs.yml:16` - Contains example code with `admin_login_secret`
2. `terraform\azure-sql-managed-instance\terraform.tfvars.example:17` - Contains example password placeholder

## Solution Applied

### ✅ Fixed: azure-sql-managed-instance/terraform.tfvars.example

**Line 17 changed from:**
```hcl
# administrator_login_password = "YourSecureP@ssw0rd123!"  # Leave commented to auto-generate
```

**To:**
```hcl
# administrator_login_password = "YourSecureP@ssw0rd123!"  # pragma: allowlist secret - Leave commented to auto-generate
```

### ⚠️ Needs Manual Fix: terraform/azure_sql/terraform-docs.yml

**File location:** `D:\DevOps\DTE\vmware\source_code\cloud-platform-vm-migration\terraform\azure_sql\terraform-docs.yml`

**Action required:** Add `# pragma: allowlist secret` comment to line 16

**Find this line (around line 50-52):**
```yaml
    # Authentication
    administrator_login    = "sqladmin"
    admin_login_secret     = var.sql_admin_credentials
```

**Change to:**
```yaml
    # Authentication
    administrator_login    = "sqladmin"
    admin_login_secret     = var.sql_admin_credentials  # pragma: allowlist secret
```

**There are TWO occurrences in the file. Update BOTH:**

1. **First occurrence** (around line 50-52) in the "Basic Usage" section
2. **Second occurrence** (around line 90-92) in the "Advanced Usage" section

## Manual Fix Instructions

### Option 1: Using VS Code or Text Editor

1. Open file: `terraform\azure_sql\terraform-docs.yml`
2. Press `Ctrl+F` and search for: `admin_login_secret`
3. You'll find 2 occurrences
4. Add ` # pragma: allowlist secret` at the end of each line
5. Save the file

### Option 2: Using PowerShell

```powershell
$file = "D:\DevOps\DTE\vmware\source_code\cloud-platform-vm-migration\terraform\azure_sql\terraform-docs.yml"
$content = Get-Content $file -Raw
$content = $content -replace 'admin_login_secret     = var.sql_admin_credentials', 'admin_login_secret     = var.sql_admin_credentials  # pragma: allowlist secret'
Set-Content -Path $file -Value $content
```

### Option 3: Using Git Bash or WSL

```bash
cd /d/DevOps/DTE/vmware/source_code/cloud-platform-vm-migration/terraform/azure_sql
sed -i 's/admin_login_secret     = var.sql_admin_credentials/admin_login_secret     = var.sql_admin_credentials  # pragma: allowlist secret/g' terraform-docs.yml
```

## Verification

After making the changes, run:

```bash
git add .
pre-commit run detect-secrets --all-files
```

If successful, you should see:
```
Detect secrets...........................................................Passed
```

## Why These Are False Positives

1. **terraform-docs.yml**: This is documentation/example code showing HOW to use the module. The `admin_login_secret` is a variable reference, not an actual secret.

2. **terraform.tfvars.example**: This is an example configuration file (not the actual config). The password shown is just a placeholder example, not a real credential.

## Security Note

The actual secrets should NEVER be committed to git. They should be:
- Auto-generated by Terraform (using `random_password` resource)
- Stored in Azure Key Vault
- Passed via environment variables
- Managed through CI/CD secrets

The `.gitignore` files in both modules already exclude actual `terraform.tfvars` files:
```gitignore
*.tfvars
!*.tfvars.example
!environments/*.tfvars
```

This ensures:
- ✅ Example files ARE committed (they're safe)
- ✅ Actual config files with real passwords are NOT committed
- ✅ Environment-specific configs in `/environments/` ARE committed (they don't contain secrets either)

## Summary

- ✅ **azure-sql-managed-instance/terraform.tfvars.example** - Fixed
- ⚠️  **azure_sql/terraform-docs.yml** - Needs manual fix (2 lines)

After fixing the terraform-docs.yml file, your pre-commit hooks should pass successfully!
